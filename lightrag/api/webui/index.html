<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="icon" type="image/x-icon" href="https://ae7an1f5d2ydi587.public.blob.vercel-storage.com/Augentik/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Augentik</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet" crossorigin="anonymous">
    <!-- Klaviyo Form Script - Updated with correct API key format -->
    <script type="text/javascript" async src="https://static.klaviyo.com/onsite/js/TwzEQD/klaviyo.js"></script>
    <link rel="modulepreload" crossorigin href="/assets/react-vendor-B4rOHfEm-Da6B99s0.js">
    <link rel="modulepreload" crossorigin href="/assets/ui-vendor-D8S1t7W6-DHR4uRRW.js">
    <link rel="modulepreload" crossorigin href="/assets/utils-vendor-yYjR-JpY-ByJxZb2l.js">
    <link rel="modulepreload" crossorigin href="/assets/feature-graph-Wd3Wvzy0-HMX_quWC.js">
    <link rel="modulepreload" crossorigin href="/assets/feature-documents-TYFog0It-DQRnp6ov.js">
    <link rel="modulepreload" crossorigin href="/assets/mermaid-vendor-DRXBiZaJ-BQYmTMhJ.js">
    <link rel="modulepreload" crossorigin href="/assets/markdown-vendor-XNcT6d8I-Db4GnQXZ.js">
    <link rel="modulepreload" crossorigin href="/assets/feature-retrieval-DFJWfhQ--DMPCAl-5.js">
    <script type="module" crossorigin src="/assets/index-CnQ5AggB.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-CR3Yy6RD.css">
  </head>
  <body>
    <div id="root"></div>

    <script>
      // DIRECT OVERLAY MOUNT: Login form UI
      let overlayRoot = null;

      function createOverlayRoot() {
        if (overlayRoot) return overlayRoot;
        overlayRoot = document.createElement('div');
        overlayRoot.id = 'login-overlay-direct';
        overlayRoot.style.cssText = 'position:fixed;inset:0;z-index:999999;background:#000;display:none;';
        document.body.appendChild(overlayRoot);
        return overlayRoot;
      }

      function mountDirectLoginOverlay() {
        if (!window.location.hash.match(/#\/?login/i)) {
          if (overlayRoot) overlayRoot.style.display = 'none';
          return;
        }

        console.log('DIRECT: Mounting login overlay for hash:', window.location.hash);
        const root = createOverlayRoot();
        root.style.display = 'block';

        // HARDCODED RICH SIGNIN COMPONENT
        root.innerHTML = `
          <div style="height:100vh;display:flex;font-family:system-ui;background:#000;color:#fff;">
            <div style="flex:1;display:flex;align-items:center;justify-content:center;padding:2rem;">
              <div style="width:100%;max-width:400px;">
                <h1 style="font-size:2.5rem;margin-bottom:1rem;font-weight:300;">Sign in to experience the future of audit</h1>
                <p style="margin-bottom:2rem;opacity:0.7;">Use your Augentik credentials to continue.</p>

                <form id="direct-login-form" style="display:flex;flex-direction:column;gap:1.5rem;">
                  <div>
                    <label style="display:block;margin-bottom:0.5rem;font-size:0.9rem;opacity:0.8;">Username</label>
                    <input name="username" type="text" placeholder="Enter your username" style="width:100%;padding:1rem;border-radius:1rem;border:1px solid #333;background:#111;color:#fff;" required>
                  </div>

                  <div>
                    <label style="display:block;margin-bottom:0.5rem;font-size:0.9rem;opacity:0.8;">Password</label>
                    <input name="password" type="password" placeholder="Enter your password" style="width:100%;padding:1rem;border-radius:1rem;border:1px solid #333;background:#111;color:#fff;" required>
                  </div>

                  <button type="submit" style="width:100%;padding:1rem;border-radius:1rem;background:#6366f1;color:#fff;border:none;font-weight:600;cursor:pointer;margin-top:1rem;">
                    Sign In
                  </button>
                </form>

                <button onclick="window.location.hash=''" style="position:absolute;top:20px;right:20px;background:#333;border:none;color:#fff;padding:10px;border-radius:50%;cursor:pointer;">✕</button>
              </div>
            </div>

            <div style="flex:1;background:url('https://ifonjarzvpechegr.public.blob.vercel-storage.com/Login%20Page%20Visuals.png') center/cover;position:relative;">
              <div style="position:absolute;bottom:2rem;left:50%;transform:translateX(-50%);display:flex;gap:1rem;">
                <div style="background:rgba(0,0,0,0.7);padding:1rem;border-radius:1rem;max-width:250px;">
                  <div style="display:flex;gap:0.5rem;margin-bottom:0.5rem;">
                    <img src="https://images.unsplash.com/photo-1547425260-76bcadfb4f2c?q=80&w=32&auto=format&fit=crop" style="width:32px;height:32px;border-radius:50%;">
                    <div>
                      <div style="font-weight:600;font-size:0.9rem;">Marcus Johnson</div>
                      <div style="opacity:0.7;font-size:0.8rem;">@ManufacturingIndustry</div>
                    </div>
                  </div>
                  <p style="font-size:0.8rem;">"Our team used to stop everything during audit season. Now, it feels like the audit just… runs itself."</p>
                </div>
              </div>
            </div>
          </div>
        `;

        // REAL LOGIN HANDLER
        document.getElementById('direct-login-form').onsubmit = async function(e) {
          e.preventDefault();
          const username = e.target.username.value;
          const password = e.target.password.value;

          if (!username || !password) {
            alert('Please enter both username and password');
            return;
          }

          console.log('DIRECT: Real login attempt with endpoint /login');

          const params = new URLSearchParams();
          params.append('username', username);
          params.append('password', password);

          try {
            const res = await fetch('/login', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
              },
              body: params.toString(),
            });

            console.log('DIRECT: Login response status:', res.status);

            if (!res.ok) {
              const txt = await res.text();
              console.log('DIRECT: Login failed with response:', txt);
              throw new Error(txt || `Login failed: ${res.status}`);
            }

            const json = await res.json();
            if (!json.access_token) throw new Error('No access_token in response');

            console.log('DIRECT: Login successful, storing token and clearing hash');
            localStorage.setItem('augentik_token', String(json.access_token));
            window.location.hash = '';
          } catch (err) {
            console.error('DIRECT: Login error', err);
            alert('Login failed. Please check your credentials and try again.');
          }
        };
      }

      window.addEventListener('DOMContentLoaded', mountDirectLoginOverlay);
      window.addEventListener('hashchange', mountDirectLoginOverlay);
    </script>

    <!-- Zoho Form Modal -->
    <div id="zoho-exclusive-overlay" hidden style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.65);z-index:1000;"></div>
    <div id="zoho-exclusive-modal" hidden role="dialog" aria-modal="true" aria-labelledby="zoho-exclusive-title" style="display:none;position:fixed;inset:0;z-index:1001;justify-content:center;align-items:center;">
      <div style="background:#1a1a1a;border-radius:12px;padding:0;max-width:500px;width:90%;max-height:80vh;overflow:hidden;border:1px solid #333;">
        <div style="display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid #333;">
          <h2 id="zoho-exclusive-title" style="margin:0;color:#fff;font-size:18px;font-weight:600;">Request Exclusive Access</h2>
          <button id="zoho-exclusive-close" aria-label="Close" style="background:#111;border:1px solid #333;color:#bbb;border-radius:8px;padding:6px 10px;cursor:pointer;">✕</button>
        </div>
        <div style="padding:0;height:400px;">
          <iframe src="https://forms.zohopublic.eu/nandiniauge1/form/Requestafreetrial/formperma/MWU4mCzC_8wGeyhrqD9YtBM7WLeZWjhMXJeSTtBBREM"
                  style="width:100%;height:100%;border:none;"
                  frameborder="0"
                  allowfullscreen>
          </iframe>
        </div>
      </div>
    </div>

    <script>
      // Zoho modal controls
      document.addEventListener('DOMContentLoaded', function() {
        var btn = document.getElementById('exclusive-access-launch');
        var overlay = document.getElementById('zoho-exclusive-overlay');
        var modal = document.getElementById('zoho-exclusive-modal');
        var closeBtn = document.getElementById('zoho-exclusive-close');

        function openModal() {
          overlay.hidden = false;
          modal.hidden = false;
          overlay.style.display = 'block';
          modal.style.display = 'flex';
          document.body.style.overflow = 'hidden';
        }

        function closeModal() {
          overlay.hidden = true;
          modal.hidden = true;
          overlay.style.display = 'none';
          modal.style.display = 'none';
          document.body.style.overflow = '';
        }

        if (btn) btn.addEventListener('click', openModal);
        if (closeBtn) closeBtn.addEventListener('click', closeModal);
        if (overlay) overlay.addEventListener('click', closeModal);
      });
    </script>
  </body>
</html>
