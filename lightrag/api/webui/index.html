<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Augentik</title>
    <link rel="icon" type="image/x-icon" href="https://ae7an1f5d2ydi587.public.blob.vercel-storage.com/Augentik/favicon.ico" />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="preload" href="https://use.typekit.net/af/efe4a5/00000000000000007735e609/30/l?primer=7cdcb44be4a7db8877ffa5c0007b8dd865b3bbc383831fe2ea177f62257a9191&fvd=n4&v=3" as="font" type="font/woff2" crossorigin>

    <!-- Auth bridge: attach Authorization to /api/*, handle 401, support XHR -->
    <script>
      (function(){
        var TOKEN_KEY = 'augentik_token';
        function getToken(){ try { return localStorage.getItem(TOKEN_KEY) || ''; } catch(_) { return ''; } }
        function clearToken(){ try { localStorage.removeItem(TOKEN_KEY); } catch(_) {} }
        function onUnauthorized(){
          clearToken();
          var target = '/webui/#/login';
          var onLogin = location.pathname.indexOf('/webui') === 0 && /#\/?login$/i.test(location.hash || '');
          if (!onLogin) { try { location.assign(target); } catch(_) {} }
        }
        function shouldAuth(url){
          try { var u = new URL(url, location.href); return u.origin === location.origin && u.pathname.startsWith('/api/'); }
          catch(_) { return false; }
        }
        // fetch bridge
        try {
          var _fetch = window.fetch.bind(window);
          window.fetch = function(input, init){
            var url = (typeof input === 'string') ? input : (input && input.url) || '';
            if (shouldAuth(url)){
              init = init || {};
              var headers = new Headers(init.headers || (typeof input !== 'string' && input && input.headers) || {});
              if (!headers.has('Authorization')){
                var t = getToken(); if (t) headers.set('Authorization', 'Bearer ' + t);
              }
              init.headers = headers;
            }
            return _fetch(input, init).then(function(res){ if (res && res.status === 401) onUnauthorized(); return res; });
          };
        } catch(_) {}
        // XHR bridge
        try {
          var OrigXHR = window.XMLHttpRequest;
          function PatchedXHR(){
            var xhr = new OrigXHR();
            var _url = '';
            var _open = xhr.open;
            xhr.open = function(method, url){ _url = url; return _open.apply(xhr, arguments); };
            var _send = xhr.send;
            xhr.send = function(body){
              try { if (shouldAuth(_url)) { var t = getToken(); if (t) xhr.setRequestHeader('Authorization', 'Bearer ' + t); } } catch(_) {}
              xhr.addEventListener('load', function(){ if (xhr.status === 401) onUnauthorized(); });
              return _send.apply(xhr, arguments);
            };
            return xhr;
          }
          window.XMLHttpRequest = PatchedXHR;
          window.AugentikAuth = { logout: function(){ clearToken(); try { location.assign('/webui/#/login'); } catch(_) {} }, token: getToken };
        } catch(_) {}
      })();
    </script>

    <!-- Stay-on-origin guard: normalize any links/windows targeting Railway webui back to this origin -->
    <script>
      (function(){
        function normalize(url){
          try {
            var u = new URL(url, location.href);
            if (/railway\.app$/i.test(u.hostname) && /\/webui\//.test(u.pathname)){
              return location.origin + u.pathname + u.search + u.hash;
            }
          } catch(_) {}
          return url;
        }
        // Intercept anchor clicks
        window.addEventListener('click', function(e){
          try{
            var a = e.target && (e.target.closest ? e.target.closest('a[href]') : null);
            if (!a) return;
            var href = a.getAttribute('href');
            if (!href) return;
            var fixed = normalize(href);
            if (fixed !== href){
              e.preventDefault();
              location.assign(fixed);
            }
          }catch(_){}
        }, true);
        // Intercept window.open
        try{
          var _open = window.open;
          window.open = function(u, n, f){ return _open.call(window, normalize(u), n, f); };
        }catch(_){}
      })();
    </script>

    <!-- Load the prebuilt LightRAG WebUI at runtime to avoid Vite resolving it during build -->
    <script>
      (function(){
        var isLocalDev = /^(localhost|127\.0\.0\.1)$/i.test(location.hostname) && !!location.port;
        if (isLocalDev) return; // avoid 404 noise during vite dev/preview

        function onLoginRoute(){
          try { return location.pathname.indexOf('/webui') === 0 && /#\/?login$/i.test(location.hash || ''); }
          catch(_) { return false; }
        }

        function loadWebUI(){
          if (window.__webuiLoaded) return;
          window.__webuiLoaded = true;
          function ensureCss(href){
            if (document.querySelector('link[data-webui-css="'+href+'"]')) return;
            var l = document.createElement('link');
            l.rel = 'stylesheet';
            l.crossOrigin = '';
            l.href = href;
            l.setAttribute('data-webui-css', href);
            document.head.appendChild(l);
          }
          // Inject CSS first for better FOUC control
          ensureCss('/webui/assets/feature-graph-HI4LhrlC.css');
          ensureCss('/webui/assets/index-Ujjbvor2.css');
          var src = '/webui/assets/index-Bo0kGtUI.js';
          var s = document.createElement('script');
          s.type = 'module';
          s.crossOrigin = '';
          s.src = src;
          document.head.appendChild(s);
        }

        // Only load the prebuilt WebUI when NOT on the login route to avoid interference
        if (!onLoginRoute()) loadWebUI();
        window.addEventListener('hashchange', function(){ if (!onLoginRoute()) loadWebUI(); });
      })();
    </script>
    <!-- CSS for the prebuilt WebUI will be injected at runtime along with the JS bundle -->
    <script type="module" crossorigin src="/assets/index-BosAmzVx.js"></script>
  </head>
  <body>
    <div id="root"></div>

    <!-- Overlay app entry: mounts our login UI at /webui/#/login and wires "Sign In" links -->
  </body>
  </html>
